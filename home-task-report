###################################
## Connect to OS without password##
###################################
1. init=/bin/sh

linux16 /vmlinuz-3.10.0-1160.15.2.el7.x86_64 root=/dev/mapper/VolGroup\00-LogVol00 ro no_timer_check console=tty0 console=ttyS0,115200nB net.ifnames=\0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 r\d.lvm.lv=VolGroup00/LogVol01 rhgb quiet LANG=en_US.UTF-8 init=/bin/sh

mount -o remount,rw /
mount | grep root
/dev/mapper/centos-root on / type xfs (rw,relatime,attr2,inode64,noquota)

2. rd.break
linux16 /vmlinuz-3.10.0-1160.15.2.el7.x86_64 root=/dev/mapper/VolGroup\00-LogVol00 ro no_timer_check console=tty0 console=ttyS0,115200nB net.ifnames=\0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 r\d.lvm.lv=VolGroup00/LogVol01 LANG=en_US.UTF-8 rd.break

mount -o remount,rw /sysroot
chroot /sysroot
touch /.autorelabe

3. rw init=/sysroot/bin/sh
linux16 /vmlinuz-3.10.0-1160.15.2.el7.x86_64 root=/dev/mapper/VolGroup\00-LogVol00 rw init=/sysroot/bin/sh no_timer_check console=tty0 console=ttyS0,115200nB net.ifnames=\0 biosdevname=0 elevator=noop crashkernel=auto rd.lvm.lv=VolGroup00/LogVol00 r\d.lvm.lv=VolGroup00/LogVol01 rhgb quiet LANG=en_US.UTF-8 



###############
## Rename VG ##
###############

[root@localhost ~]# vgs
  VG     #PV #LV #SN Attr   VSize VFree
  centos   1   2   0 wz--n- 6.80g    0
[root@localhost ~]# pvs
  PV         VG     Fmt  Attr PSize PFree
  /dev/sda3  centos lvm2 a--  6.80g    0
[root@localhost ~]# lvs
  LV   VG     Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root centos -wi-ao----   6.00g
  swap centos -wi-ao---- 820.00m

[root@localhost ~]# lsblk
NAME            MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda               8:0    0    8G  0 disk
├─sda1            8:1    0  200M  0 part /boot/efi
├─sda2            8:2    0    1G  0 part /boot
└─sda3            8:3    0  6.8G  0 part
  ├─centos-root 253:0    0    6G  0 lvm  /
  └─centos-swap 253:1    0  820M  0 lvm  [SWAP]
sr0              11:0    1 58.2M  0 rom

# Rename VG
[root@localhost ~]# vgrename centos OtusRoot
  Volume group "centos" successfully renamed to "OtusRoot"
  
[root@localhost ~]# vgs
  VG       #PV #LV #SN Attr   VSize VFree
  OtusRoot   1   2   0 wz--n- 6.80g    0
  

#Содержимое fstab до изменения
[root@localhost ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Tue Feb 16 14:28:43 2021
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/centos-root /                       xfs     defaults        0 0
UUID=178e5c27-68c9-4a07-91f4-9fc93012d4f3 /boot                   xfs     defaults        0 0
UUID=CEAC-5202          /boot/efi               vfat    umask=0077,shortname=winnt 0 0
/dev/mapper/centos-swap swap                    swap    defaults        0 0

[root@localhost ~]# vi /etc/fstab

#Содержимое fstab после изменения
[root@localhost ~]# cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Tue Feb 16 14:28:43 2021
#
# Accessible filesystems, by reference, are maintained under '/dev/disk'
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info
#
/dev/mapper/OtusRoot-root /                       xfs     defaults        0 0
UUID=178e5c27-68c9-4a07-91f4-9fc93012d4f3 /boot                   xfs     defaults        0 0
UUID=CEAC-5202          /boot/efi               vfat    umask=0077,shortname=winnt 0 0
/dev/mapper/OtusRoot-swap swap  

#Содержимое /etc/default/grub до зменения
[root@localhost ~]# cat /etc/default/grub
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto spectre_v2=retpoline rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet"
GRUB_DISABLE_RECOVERY="true"
[root@localhost ~]# vi /etc/default/grub


#Содержимое /etc/default/grub после изменения
[root@localhost ~]# cat /etc/default/grub
GRUB_TIMEOUT=5
GRUB_DISTRIBUTOR="$(sed 's, release .*$,,g' /etc/system-release)"
GRUB_DEFAULT=saved
GRUB_DISABLE_SUBMENU=true
GRUB_TERMINAL_OUTPUT="console"
GRUB_CMDLINE_LINUX="crashkernel=auto spectre_v2=retpoline rd.lvm.lv=OtusRoot/root rd.lvm.lv=OtusRoot/swap rhgb quiet"
GRUB_DISABLE_RECOVERY="true"



[root@localhost ~]# ls /boot/efi/EFI/centos/grub
grub.cfg     grubenv      grubx64.efi
[root@localhost ~]# ls /boot/efi/EFI/centos/
BOOT.CSV     fonts     grubenv      mmx64.efi       shim.efi            shimx64.efi
BOOTX64.CSV  grub.cfg  grubx64.efi  MokManager.efi  shimx64-centos.efi



#Содержимое /boot/efi/EFI/centos/grub.cfg до изменения
[root@localhost ~]# cat /boot/efi/EFI/centos/grub.cfg
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_output console
if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=5
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=5
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/00_tuned ###
set tuned_params=""
set tuned_initrd=""
### END /etc/grub.d/00_tuned ###

### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/10_linux ###
menuentry 'CentOS Linux (3.10.0-1160.15.2.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-1160.el7.x86_64-advanced-59f88f98-4754-41a9-8439-d6b88b42acbc' {
        load_video
        set gfxpayload=keep
        insmod gzio
        insmod part_gpt
        insmod xfs
        set root='hd0,gpt2'
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2  178e5c27-68c9-4a07-91f4-9fc93012d4f3
        else
          search --no-floppy --fs-uuid --set=root 178e5c27-68c9-4a07-91f4-9fc93012d4f3
        fi
        linuxefi /vmlinuz-3.10.0-1160.15.2.el7.x86_64 root=/dev/mapper/centos-root ro crashkernel=auto spectre_v2=retpoline rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet LANG=en_US.UTF-8
        initrdefi /initramfs-3.10.0-1160.15.2.el7.x86_64.img
}
menuentry 'CentOS Linux (3.10.0-1160.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-1160.el7.x86_64-advanced-59f88f98-4754-41a9-8439-d6b88b42acbc' {
        load_video
        set gfxpayload=keep
        insmod gzio
        insmod part_gpt
        insmod xfs
        set root='hd0,gpt2'
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2  178e5c27-68c9-4a07-91f4-9fc93012d4f3
        else
          search --no-floppy --fs-uuid --set=root 178e5c27-68c9-4a07-91f4-9fc93012d4f3
        fi
        linuxefi /vmlinuz-3.10.0-1160.el7.x86_64 root=/dev/mapper/centos-root ro crashkernel=auto spectre_v2=retpoline rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet LANG=en_US.UTF-8
        initrdefi /initramfs-3.10.0-1160.el7.x86_64.img
}
menuentry 'CentOS Linux (0-rescue-549c43343763df448b0b5dcc026b3e1b) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-0-rescue-549c43343763df448b0b5dcc026b3e1b-advanced-59f88f98-4754-41a9-8439-d6b88b42acbc' {
        load_video
        insmod gzio
        insmod part_gpt
        insmod xfs
        set root='hd0,gpt2'
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2  178e5c27-68c9-4a07-91f4-9fc93012d4f3
        else
          search --no-floppy --fs-uuid --set=root 178e5c27-68c9-4a07-91f4-9fc93012d4f3
        fi
        linuxefi /vmlinuz-0-rescue-549c43343763df448b0b5dcc026b3e1b root=/dev/mapper/centos-root ro crashkernel=auto spectre_v2=retpoline rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet
        initrdefi /initramfs-0-rescue-549c43343763df448b0b5dcc026b3e1b.img
}

### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###
[root@localhost ~]# vi /boot/efi/EFI/centos/grub.cfg



#Содержимое /boot/efi/EFI/centos/grub.cfg после изменения
[root@localhost ~]# cat /boot/efi/EFI/centos/grub.cfg
#
# DO NOT EDIT THIS FILE
#
# It is automatically generated by grub2-mkconfig using templates
# from /etc/grub.d and settings from /etc/default/grub
#

### BEGIN /etc/grub.d/00_header ###
set pager=1

if [ -s $prefix/grubenv ]; then
  load_env
fi
if [ "${next_entry}" ] ; then
   set default="${next_entry}"
   set next_entry=
   save_env next_entry
   set boot_once=true
else
   set default="${saved_entry}"
fi

if [ x"${feature_menuentry_id}" = xy ]; then
  menuentry_id_option="--id"
else
  menuentry_id_option=""
fi

export menuentry_id_option

if [ "${prev_saved_entry}" ]; then
  set saved_entry="${prev_saved_entry}"
  save_env saved_entry
  set prev_saved_entry=
  save_env prev_saved_entry
  set boot_once=true
fi

function savedefault {
  if [ -z "${boot_once}" ]; then
    saved_entry="${chosen}"
    save_env saved_entry
  fi
}

function load_video {
  if [ x$feature_all_video_module = xy ]; then
    insmod all_video
  else
    insmod efi_gop
    insmod efi_uga
    insmod ieee1275_fb
    insmod vbe
    insmod vga
    insmod video_bochs
    insmod video_cirrus
  fi
}

terminal_output console
if [ x$feature_timeout_style = xy ] ; then
  set timeout_style=menu
  set timeout=5
# Fallback normal timeout code in case the timeout_style feature is
# unavailable.
else
  set timeout=5
fi
### END /etc/grub.d/00_header ###

### BEGIN /etc/grub.d/00_tuned ###
set tuned_params=""
set tuned_initrd=""
### END /etc/grub.d/00_tuned ###

### BEGIN /etc/grub.d/01_users ###
if [ -f ${prefix}/user.cfg ]; then
  source ${prefix}/user.cfg
  if [ -n "${GRUB2_PASSWORD}" ]; then
    set superusers="root"
    export superusers
    password_pbkdf2 root ${GRUB2_PASSWORD}
  fi
fi
### END /etc/grub.d/01_users ###

### BEGIN /etc/grub.d/10_linux ###
menuentry 'CentOS Linux (3.10.0-1160.15.2.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-1160.el7.x86_64-advanced-59f88f98-4754-41a9-8439-d6b88b42acbc' {
        load_video
        set gfxpayload=keep
        insmod gzio
        insmod part_gpt
        insmod xfs
        set root='hd0,gpt2'
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2  178e5c27-68c9-4a07-91f4-9fc93012d4f3
        else
          search --no-floppy --fs-uuid --set=root 178e5c27-68c9-4a07-91f4-9fc93012d4f3
        fi
        linuxefi /vmlinuz-3.10.0-1160.15.2.el7.x86_64 root=/dev/mapper/OtusRoot-root ro crashkernel=auto spectre_v2=retpoline rd.lvm.lv=OtusRoot/root rd.lvm.lv=OtusRoot/swap rhgb quiet LANG=en_US.UTF-8
        initrdefi /initramfs-3.10.0-1160.15.2.el7.x86_64.img
}
menuentry 'CentOS Linux (3.10.0-1160.el7.x86_64) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-3.10.0-1160.el7.x86_64-advanced-59f88f98-4754-41a9-8439-d6b88b42acbc' {
        load_video
        set gfxpayload=keep
        insmod gzio
        insmod part_gpt
        insmod xfs
        set root='hd0,gpt2'
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2  178e5c27-68c9-4a07-91f4-9fc93012d4f3
        else
          search --no-floppy --fs-uuid --set=root 178e5c27-68c9-4a07-91f4-9fc93012d4f3
        fi
        linuxefi /vmlinuz-3.10.0-1160.el7.x86_64 root=/dev/mapper/centos-root ro crashkernel=auto spectre_v2=retpoline rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet LANG=en_US.UTF-8
        initrdefi /initramfs-3.10.0-1160.el7.x86_64.img
}
menuentry 'CentOS Linux (0-rescue-549c43343763df448b0b5dcc026b3e1b) 7 (Core)' --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option 'gnulinux-0-rescue-549c43343763df448b0b5dcc026b3e1b-advanced-59f88f98-4754-41a9-8439-d6b88b42acbc' {
        load_video
        insmod gzio
        insmod part_gpt
        insmod xfs
        set root='hd0,gpt2'
        if [ x$feature_platform_search_hint = xy ]; then
          search --no-floppy --fs-uuid --set=root --hint-bios=hd0,gpt2 --hint-efi=hd0,gpt2 --hint-baremetal=ahci0,gpt2  178e5c27-68c9-4a07-91f4-9fc93012d4f3
        else
          search --no-floppy --fs-uuid --set=root 178e5c27-68c9-4a07-91f4-9fc93012d4f3
        fi
        linuxefi /vmlinuz-0-rescue-549c43343763df448b0b5dcc026b3e1b root=/dev/mapper/centos-root ro crashkernel=auto spectre_v2=retpoline rd.lvm.lv=centos/root rd.lvm.lv=centos/swap rhgb quiet
        initrdefi /initramfs-0-rescue-549c43343763df448b0b5dcc026b3e1b.img
}

### END /etc/grub.d/10_linux ###

### BEGIN /etc/grub.d/20_linux_xen ###
### END /etc/grub.d/20_linux_xen ###

### BEGIN /etc/grub.d/20_ppc_terminfo ###
### END /etc/grub.d/20_ppc_terminfo ###

### BEGIN /etc/grub.d/30_os-prober ###
### END /etc/grub.d/30_os-prober ###

### BEGIN /etc/grub.d/40_custom ###
# This file provides an easy way to add custom menu entries.  Simply type the
# menu entries you want to add after this comment.  Be careful not to change
# the 'exec tail' line above.
### END /etc/grub.d/40_custom ###

### BEGIN /etc/grub.d/41_custom ###
if [ -f  ${config_directory}/custom.cfg ]; then
  source ${config_directory}/custom.cfg
elif [ -z "${config_directory}" -a -f  $prefix/custom.cfg ]; then
  source $prefix/custom.cfg;
fi
### END /etc/grub.d/41_custom ###

[root@localhost ~]# ls /boot
config-3.10.0-1160.15.2.el7.x86_64                       initramfs-3.10.0-1160.el7.x86_64kdump.img
config-3.10.0-1160.el7.x86_64                            symvers-3.10.0-1160.15.2.el7.x86_64.gz
efi                                                      symvers-3.10.0-1160.el7.x86_64.gz
grub                                                     System.map-3.10.0-1160.15.2.el7.x86_64
grub2                                                    System.map-3.10.0-1160.el7.x86_64
initramfs-0-rescue-549c43343763df448b0b5dcc026b3e1b.img  vmlinuz-0-rescue-549c43343763df448b0b5dcc026b3e1b
initramfs-3.10.0-1160.15.2.el7.x86_64.img                vmlinuz-3.10.0-1160.15.2.el7.x86_64
initramfs-3.10.0-1160.15.2.el7.x86_64kdump.img           vmlinuz-3.10.0-1160.el7.x86_64
initramfs-3.10.0-1160.el7.x86_64.img


[root@localhost ~]# mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
Executing: /sbin/dracut -f -v /boot/initramfs-3.10.0-1160.15.2.el7.x86_64.img 3.10.0-1160.15.2.el7.x86_64
dracut module 'modsign' will not be installed, because command 'keyctl' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'cifs' will not be installed, because command 'mount.cifs' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsistart' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsi-iname' could not be found!
95nfs: Could not find any command of 'rpcbind portmap'!
dracut module 'modsign' will not be installed, because command 'keyctl' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'cifs' will not be installed, because command 'mount.cifs' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsistart' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsi-iname' could not be found!
95nfs: Could not find any command of 'rpcbind portmap'!
*** Including module: bash ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: network ***
*** Including module: ifcfg ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: microcode_ctl-fw_dir_override ***
  microcode_ctl module: mangling fw_dir
    microcode_ctl: reset fw_dir to "/lib/firmware/updates /lib/firmware"
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel"...
intel: model '', path ' intel-ucode/*', kvers ''
intel: blacklist ''
      microcode_ctl: intel: caveats check for kernel version "3.10.0-1160.15.2.el7.x86_64" passed, adding "/usr/share/microcode_ctl/ucode_with_caveats/intel" to fw_dir variable
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-2d-07"...
intel-06-2d-07: model 'GenuineIntel 06-2d-07', path ' intel-ucode/06-2d-07', kvers ''
intel-06-2d-07: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-2d-07', skipping
    microcode_ctl: configuration "intel-06-2d-07" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-4e-03"...
intel-06-4e-03: model 'GenuineIntel 06-4e-03', path ' intel-ucode/06-4e-03', kvers ''
intel-06-4e-03: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-4e-03', skipping
    microcode_ctl: configuration "intel-06-4e-03" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-4f-01"...
intel-06-4f-01: model 'GenuineIntel 06-4f-01', path ' intel-ucode/06-4f-01', kvers ' 4.17.0 3.10.0-894 3.10.0-862.6.1 3.10.0-693.35.1 3.10.0-514.52.1 3.10.0-327.70.1 2.6.32-754.1.1 2.6.32-573.58.1 2.6.32-504.71.1 2.6.32-431.90.1 2.6.32-358.90.1'
intel-06-4f-01: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-4f-01', skipping
    microcode_ctl: configuration "intel-06-4f-01" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-55-04"...
intel-06-55-04: model 'GenuineIntel 06-55-04', path ' intel-ucode/06-55-04', kvers ''
intel-06-55-04: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-55-04', skipping
    microcode_ctl: configuration "intel-06-55-04" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-5e-03"...
intel-06-5e-03: model 'GenuineIntel 06-5e-03', path ' intel-ucode/06-5e-03', kvers ''
intel-06-5e-03: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-5e-03', skipping
    microcode_ctl: configuration "intel-06-5e-03" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-8c-01"...
intel-06-8c-01: model 'GenuineIntel 06-8c-01', path ' intel-ucode/06-8c-01', kvers ''
intel-06-8c-01: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-8c-01', skipping
    microcode_ctl: configuration "intel-06-8c-01" is ignored
    microcode_ctl: final fw_dir: "/usr/share/microcode_ctl/ucode_with_caveats/intel /lib/firmware/updates /lib/firmware"
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** Constructing GenuineIntel.bin ****
*** Store current command line parameters ***
*** Creating image file ***
*** Creating microcode section ***
*** Created microcode section ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-1160.15.2.el7.x86_64.img' done ***


[root@localhost ~]# ls /boot
config-3.10.0-1160.15.2.el7.x86_64                       initramfs-3.10.0-1160.el7.x86_64kdump.img
config-3.10.0-1160.el7.x86_64                            symvers-3.10.0-1160.15.2.el7.x86_64.gz
efi                                                      symvers-3.10.0-1160.el7.x86_64.gz
grub                                                     System.map-3.10.0-1160.15.2.el7.x86_64
grub2                                                    System.map-3.10.0-1160.el7.x86_64
initramfs-0-rescue-549c43343763df448b0b5dcc026b3e1b.img  vmlinuz-0-rescue-549c43343763df448b0b5dcc026b3e1b
initramfs-3.10.0-1160.15.2.el7.x86_64.img                vmlinuz-3.10.0-1160.15.2.el7.x86_64
initramfs-3.10.0-1160.15.2.el7.x86_64kdump.img           vmlinuz-3.10.0-1160.el7.x86_64
initramfs-3.10.0-1160.el7.x86_64.img

reboot

#Результат
[root@localhost ~]# vgs
  VG       #PV #LV #SN Attr   VSize VFree
  OtusRoot   1   2   0 wz--n- 6.80g    0






########################## 
## Add module to initrd ##
##########################



[root@localhost ~]# vgs
  VG       #PV #LV #SN Attr   VSize VFree
  OtusRoot   1   2   0 wz--n- 6.80g    0
[root@localhost ~]# lvs
  LV   VG       Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root OtusRoot -wi-ao----   6.00g
  swap OtusRoot -wi-ao---- 820.00m
[root@localhost ~]# pvs
  PV         VG       Fmt  Attr PSize PFree
  /dev/sda3  OtusRoot lvm2 a--  6.80g    0
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]# ls /usr/lib/dracut/modules.d/
00bash               10i18n       80cms            90dmsquash-live-ntfs  90qemu-net    95fcoe       95rootfs-block  97biosdevname  99base
00systemd-bootchart  30convertfs  90bcache         90kernel-modules      91crypt-gpg   95fcoe-uefi  95ssh-client    98ecryptfs     99fs-lib
03modsign            40network    90btrfs          90livenet             91crypt-loop  95fstab-sys  95terminfo      98pollcdrom    99img-lib
03rescue             45ifcfg      90crypt          90lvm                 95cifs        95iscsi      95udev-rules    98selinux      99kdumpbase
04watchdog           45url-lib    90dm             90mdraid              95dasd        95nbd        95virtfs        98syslog       99microcode_ctl-fw_dir_override
05busybox            50drm        90dmraid         90multipath           95dasd_mod    95nfs        95zfcp          98systemd      99shutdown
05nss-softokn        50plymouth   90dmsquash-live  90qemu                95debug       95resume     95znet          98usrmount     99uefi-lib
[root@localhost ~]# mkdir /usr/lib/dracut/modules.d/01test
[root@localhost ~]# pwd
/root
[root@localhost ~]# ls -la
total 40
dr-xr-x---.  2 root root  194 Feb 17 10:33 .
dr-xr-xr-x. 17 root root  224 Feb 16 15:01 ..
-rw-------.  1 root root 1331 Feb 16 14:33 anaconda-ks.cfg
-rw-------.  1 root root  758 Feb 17 11:40 .bash_history
-rw-r--r--.  1 root root   18 Dec 28  2013 .bash_logout
-rw-r--r--.  1 root root  176 Dec 28  2013 .bash_profile
-rw-r--r--.  1 root root  176 Dec 28  2013 .bashrc
-rw-r--r--.  1 root root  100 Dec 28  2013 .cshrc
-rw-r--r--.  1 root root  117 Feb 16 15:45 gistfile1.txt
-rwxr-x---.  1 root root  126 Feb 17 10:33 module_setup.sh
-rw-r--r--.  1 root root  129 Dec 28  2013 .tcshrc
-rwxr-x---.  1 root root  332 Feb 17 10:33 test.sh
[root@localhost ~]# cp test.sh /usr/lib/dracut/modules.d/01test/
[root@localhost ~]# cp module_setup.sh /usr/lib/dracut/modules.d/01test/
[root@localhost ~]# ls -la /usr/lib/dracut/modules.d/01test
total 12
drwxr-xr-x.  2 root root   44 Feb 17 11:49 .
drwxr-xr-x. 66 root root 4096 Feb 17 11:49 ..
-rwxr-x---.  1 root root  126 Feb 17 11:49 module_setup.sh
-rwxr-x---.  1 root root  332 Feb 17 11:49 test.sh
[root@localhost ~]# mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
Executing: /sbin/dracut -f -v /boot/initramfs-3.10.0-1160.15.2.el7.x86_64.img 3.10.0-1160.15.2.el7.x86_64
dracut module 'modsign' will not be installed, because command 'keyctl' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'cifs' will not be installed, because command 'mount.cifs' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsistart' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsi-iname' could not be found!
95nfs: Could not find any command of 'rpcbind portmap'!
dracut module 'modsign' will not be installed, because command 'keyctl' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'cifs' will not be installed, because command 'mount.cifs' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsistart' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsi-iname' could not be found!
95nfs: Could not find any command of 'rpcbind portmap'!
*** Including module: bash ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: network ***
*** Including module: ifcfg ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: microcode_ctl-fw_dir_override ***
  microcode_ctl module: mangling fw_dir
    microcode_ctl: reset fw_dir to "/lib/firmware/updates /lib/firmware"
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel"...
intel: model '', path ' intel-ucode/*', kvers ''
intel: blacklist ''
      microcode_ctl: intel: caveats check for kernel version "3.10.0-1160.15.2.el7.x86_64" passed, adding "/usr/share/microcode_ctl/ucode_with_caveats/intel" to fw_dir variable
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-2d-07"...
intel-06-2d-07: model 'GenuineIntel 06-2d-07', path ' intel-ucode/06-2d-07', kvers ''
intel-06-2d-07: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-2d-07', skipping
    microcode_ctl: configuration "intel-06-2d-07" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-4e-03"...
intel-06-4e-03: model 'GenuineIntel 06-4e-03', path ' intel-ucode/06-4e-03', kvers ''
intel-06-4e-03: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-4e-03', skipping
    microcode_ctl: configuration "intel-06-4e-03" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-4f-01"...
intel-06-4f-01: model 'GenuineIntel 06-4f-01', path ' intel-ucode/06-4f-01', kvers ' 4.17.0 3.10.0-894 3.10.0-862.6.1 3.10.0-693.35.1 3.10.0-514.52.1 3.10.0-327.70.1 2.6.32-754.1.1 2.6.32-573.58.1 2.6.32-504.71.1 2.6.32-431.90.1 2.6.32-358.90.1'
intel-06-4f-01: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-4f-01', skipping
    microcode_ctl: configuration "intel-06-4f-01" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-55-04"...
intel-06-55-04: model 'GenuineIntel 06-55-04', path ' intel-ucode/06-55-04', kvers ''
intel-06-55-04: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-55-04', skipping
    microcode_ctl: configuration "intel-06-55-04" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-5e-03"...
intel-06-5e-03: model 'GenuineIntel 06-5e-03', path ' intel-ucode/06-5e-03', kvers ''
intel-06-5e-03: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-5e-03', skipping
    microcode_ctl: configuration "intel-06-5e-03" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-8c-01"...
intel-06-8c-01: model 'GenuineIntel 06-8c-01', path ' intel-ucode/06-8c-01', kvers ''
intel-06-8c-01: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-8c-01', skipping
    microcode_ctl: configuration "intel-06-8c-01" is ignored
    microcode_ctl: final fw_dir: "/usr/share/microcode_ctl/ucode_with_caveats/intel /lib/firmware/updates /lib/firmware"
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** Constructing GenuineIntel.bin ****
*** Store current command line parameters ***
*** Creating image file ***
*** Creating microcode section ***
*** Created microcode section ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-1160.15.2.el7.x86_64.img' done ***
[root@localhost ~]#
[root@localhost ~]# lsinitrd -m /boot/initramfs-$(uname -r).img | grep test
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]# lsinitrd -m /boot/initramfs-$(uname -r).img
Image: /boot/initramfs-3.10.0-1160.15.2.el7.x86_64.img: 21M
========================================================================
Early CPIO image
========================================================================
drwxr-xr-x   3 root     root            0 Feb 17 11:52 .
-rw-r--r--   1 root     root            2 Feb 17 11:52 early_cpio
drwxr-xr-x   3 root     root            0 Feb 17 11:52 kernel
drwxr-xr-x   3 root     root            0 Feb 17 11:52 kernel/x86
drwxr-xr-x   2 root     root            0 Feb 17 11:52 kernel/x86/microcode
-rw-r--r--   1 root     root       208896 Feb 17 11:52 kernel/x86/microcode/GenuineIntel.bin
========================================================================
Version: dracut-033-572.el7

dracut modules:
bash
nss-softokn
i18n
network
ifcfg
drm
plymouth
dm
kernel-modules
lvm
qemu
resume
rootfs-block
terminfo
udev-rules
biosdevname
systemd
usrmount
base
fs-lib
microcode_ctl-fw_dir_override
shutdown
========================================================================
[root@localhost ~]# ls -la /usr/lib/dracut/modules.d
total 16
drwxr-xr-x. 66 root root 4096 Feb 17 11:49 .
drwxr-xr-x.  4 root root  236 Feb 16 14:29 ..
drwxr-xr-x.  2 root root   29 Feb 16 14:29 00bash
drwxr-xr-x.  2 root root   29 Feb 16 14:29 00systemd-bootchart
drwxr-xr-x.  2 root root   44 Feb 17 11:49 01test
drwxr-xr-x.  2 root root   57 Feb 16 14:29 03modsign
drwxr-xr-x.  2 root root   29 Feb 16 14:29 03rescue
drwxr-xr-x.  2 root root   72 Feb 16 14:29 04watchdog
drwxr-xr-x.  2 root root   29 Feb 16 14:29 05busybox
drwxr-xr-x.  2 root root   29 Feb 16 15:29 05nss-softokn
drwxr-xr-x.  2 root root  111 Feb 16 14:29 10i18n
drwxr-xr-x.  2 root root   72 Feb 16 14:29 30convertfs
drwxr-xr-x.  2 root root 4096 Feb 16 14:29 40network
drwxr-xr-x.  2 root root   51 Feb 16 14:29 45ifcfg
drwxr-xr-x.  2 root root   47 Feb 16 14:29 45url-lib
drwxr-xr-x.  2 root root   29 Feb 16 14:29 50drm
drwxr-xr-x.  2 root root  150 Feb 16 14:29 50plymouth
drwxr-xr-x.  2 root root   92 Feb 16 14:29 80cms
drwxr-xr-x.  2 root root   29 Feb 16 14:29 90bcache
drwxr-xr-x.  2 root root  129 Feb 16 14:29 90btrfs
drwxr-xr-x.  2 root root  195 Feb 16 14:29 90crypt
drwxr-xr-x.  2 root root  130 Feb 16 14:29 90dm
drwxr-xr-x.  2 root root   93 Feb 16 14:29 90dmraid
drwxr-xr-x.  2 root root  258 Feb 16 14:29 90dmsquash-live
drwxr-xr-x.  2 root root   29 Feb 16 14:29 90dmsquash-live-ntfs
drwxr-xr-x.  2 root root   73 Feb 16 14:29 90kernel-modules
drwxr-xr-x.  2 root root  102 Feb 16 14:29 90livenet
drwxr-xr-x.  2 root root   88 Feb 16 14:29 90lvm
drwxr-xr-x.  2 root root 4096 Feb 16 14:29 90mdraid
drwxr-xr-x.  2 root root  110 Feb 16 14:29 90multipath
drwxr-xr-x.  2 root root   29 Feb 16 14:29 90qemu
drwxr-xr-x.  2 root root   29 Feb 16 14:29 90qemu-net
drwxr-xr-x.  2 root root   53 Feb 16 14:29 91crypt-gpg
drwxr-xr-x.  2 root root   54 Feb 16 14:29 91crypt-loop
drwxr-xr-x.  2 root root   92 Feb 16 14:29 95cifs
drwxr-xr-x.  2 root root   50 Feb 16 14:29 95dasd
drwxr-xr-x.  2 root root   54 Feb 16 14:29 95dasd_mod
drwxr-xr-x.  2 root root   29 Feb 16 14:29 95debug
drwxr-xr-x.  2 root root  151 Feb 16 14:29 95fcoe
drwxr-xr-x.  2 root root   54 Feb 16 14:29 95fcoe-uefi
drwxr-xr-x.  2 root root   49 Feb 16 14:29 95fstab-sys
drwxr-xr-x.  2 root root  119 Feb 16 14:29 95iscsi
drwxr-xr-x.  2 root root   71 Feb 16 14:29 95nbd
drwxr-xr-x.  2 root root  139 Feb 16 14:29 95nfs
drwxr-xr-x.  2 root root   69 Feb 16 14:29 95resume
drwxr-xr-x.  2 root root  120 Feb 16 14:29 95rootfs-block
drwxr-xr-x.  2 root root   29 Feb 16 14:29 95ssh-client
drwxr-xr-x.  2 root root   29 Feb 16 14:29 95terminfo
drwxr-xr-x.  2 root root  122 Feb 16 14:29 95udev-rules
drwxr-xr-x.  2 root root  102 Feb 16 14:29 95virtfs
drwxr-xr-x.  2 root root   50 Feb 16 14:29 95zfcp
drwxr-xr-x.  2 root root   49 Feb 16 14:29 95znet
drwxr-xr-x.  2 root root   57 Feb 16 14:29 97biosdevname
drwxr-xr-x.  2 root root   68 Feb 16 14:29 98ecryptfs
drwxr-xr-x.  2 root root   49 Feb 16 14:29 98pollcdrom
drwxr-xr-x.  2 root root   58 Feb 16 14:29 98selinux
drwxr-xr-x.  2 root root  191 Feb 16 14:29 98syslog
drwxr-xr-x.  2 root root 4096 Feb 16 14:29 98systemd
drwxr-xr-x.  2 root root   49 Feb 16 14:29 98usrmount
drwxr-xr-x.  2 root root  173 Feb 16 14:29 99base
drwxr-xr-x.  2 root root   46 Feb 16 14:29 99fs-lib
drwxr-xr-x.  2 root root   47 Feb 16 14:29 99img-lib
drwxr-xr-x.  2 root root  227 Feb 16 15:30 99kdumpbase
drwxr-xr-x.  2 root root   29 Feb 16 15:30 99microcode_ctl-fw_dir_override
drwxr-xr-x.  2 root root   48 Feb 16 14:29 99shutdown
drwxr-xr-x.  2 root root   48 Feb 16 14:29 99uefi-lib
[root@localhost ~]# ls -la /usr/lib/dracut/modules.d/01test/
total 12
drwxr-xr-x.  2 root root   44 Feb 17 11:49 .
drwxr-xr-x. 66 root root 4096 Feb 17 11:49 ..
-rwxr-x---.  1 root root  126 Feb 17 11:49 module_setup.sh
-rwxr-x---.  1 root root  332 Feb 17 11:49 test.sh





[root@localhost 01test]# cat test.sh
#!/bin/bash

exec 0<>/dev/console 1<>/dev/console 2<>/dev/console
cat <<'msgend'
Hello! You are in dracut module!
 ___________________
< I'm dracut module >
 -------------------
   \
    \
        .--.
       |o_o |
       |:_/ |
      //   \ \
     (|     | )
    /'\_   _/`\
    \___)=(___/
msgend
sleep 10
echo " continuing...."
[root@localhost 01test]# cat module-setup.sh
#!/bin/bash

check() {
    return 0
}

depends() {
    return 0
}

install() {
    inst_hook cleanup 00 "${moddir}/test.sh"
}




# Пересобираем образ initrd
[root@localhost 01test]# dracut -f -v
Executing: /sbin/dracut -f -v
dracut module 'modsign' will not be installed, because command 'keyctl' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'cifs' will not be installed, because command 'mount.cifs' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsistart' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsi-iname' could not be found!
95nfs: Could not find any command of 'rpcbind portmap'!
dracut module 'modsign' will not be installed, because command 'keyctl' could not be found!
dracut module 'busybox' will not be installed, because command 'busybox' could not be found!
dracut module 'crypt' will not be installed, because command 'cryptsetup' could not be found!
dracut module 'dmraid' will not be installed, because command 'dmraid' could not be found!
dracut module 'dmsquash-live-ntfs' will not be installed, because command 'ntfs-3g' could not be found!
dracut module 'mdraid' will not be installed, because command 'mdadm' could not be found!
dracut module 'multipath' will not be installed, because command 'multipath' could not be found!
dracut module 'cifs' will not be installed, because command 'mount.cifs' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsistart' could not be found!
dracut module 'iscsi' will not be installed, because command 'iscsi-iname' could not be found!
95nfs: Could not find any command of 'rpcbind portmap'!
*** Including module: bash ***
*** Including module: test ***
*** Including module: nss-softokn ***
*** Including module: i18n ***
*** Including module: network ***
*** Including module: ifcfg ***
*** Including module: drm ***
*** Including module: plymouth ***
*** Including module: dm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 60-persistent-storage-dm.rules
Skipping udev rule: 55-dm.rules
*** Including module: kernel-modules ***
*** Including module: lvm ***
Skipping udev rule: 64-device-mapper.rules
Skipping udev rule: 56-lvm.rules
Skipping udev rule: 60-persistent-storage-lvm.rules
*** Including module: qemu ***
*** Including module: resume ***
*** Including module: rootfs-block ***
*** Including module: terminfo ***
*** Including module: udev-rules ***
Skipping udev rule: 40-redhat-cpu-hotplug.rules
Skipping udev rule: 91-permissions.rules
*** Including module: biosdevname ***
*** Including module: systemd ***
*** Including module: usrmount ***
*** Including module: base ***
*** Including module: fs-lib ***
*** Including module: microcode_ctl-fw_dir_override ***
  microcode_ctl module: mangling fw_dir
    microcode_ctl: reset fw_dir to "/lib/firmware/updates /lib/firmware"
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel"...
intel: model '', path ' intel-ucode/*', kvers ''
intel: blacklist ''
      microcode_ctl: intel: caveats check for kernel version "3.10.0-1160.15.2.el7.x86_64" passed, adding "/usr/share/microcode_ctl/ucode_with_caveats/intel" to fw_dir variable
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-2d-07"...
intel-06-2d-07: model 'GenuineIntel 06-2d-07', path ' intel-ucode/06-2d-07', kvers ''
intel-06-2d-07: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-2d-07', skipping
    microcode_ctl: configuration "intel-06-2d-07" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-4e-03"...
intel-06-4e-03: model 'GenuineIntel 06-4e-03', path ' intel-ucode/06-4e-03', kvers ''
intel-06-4e-03: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-4e-03', skipping
    microcode_ctl: configuration "intel-06-4e-03" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-4f-01"...
intel-06-4f-01: model 'GenuineIntel 06-4f-01', path ' intel-ucode/06-4f-01', kvers ' 4.17.0 3.10.0-894 3.10.0-862.6.1 3.10.0-693.35.1 3.10.0-514.52.1 3.10.0-327.70.1 2.6.32-754.1.1 2.6.32-573.58.1 2.6.32-504.71.1 2.6.32-431.90.1 2.6.32-358.90.1'
intel-06-4f-01: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-4f-01', skipping
    microcode_ctl: configuration "intel-06-4f-01" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-55-04"...
intel-06-55-04: model 'GenuineIntel 06-55-04', path ' intel-ucode/06-55-04', kvers ''
intel-06-55-04: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-55-04', skipping
    microcode_ctl: configuration "intel-06-55-04" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-5e-03"...
intel-06-5e-03: model 'GenuineIntel 06-5e-03', path ' intel-ucode/06-5e-03', kvers ''
intel-06-5e-03: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-5e-03', skipping
    microcode_ctl: configuration "intel-06-5e-03" is ignored
    microcode_ctl: processing data directory  "/usr/share/microcode_ctl/ucode_with_caveats/intel-06-8c-01"...
intel-06-8c-01: model 'GenuineIntel 06-8c-01', path ' intel-ucode/06-8c-01', kvers ''
intel-06-8c-01: blacklist ''
Current CPU model 'GenuineIntel 06-8e-09' doesn't match configuration CPU model 'GenuineIntel 06-8c-01', skipping
    microcode_ctl: configuration "intel-06-8c-01" is ignored
    microcode_ctl: final fw_dir: "/usr/share/microcode_ctl/ucode_with_caveats/intel /lib/firmware/updates /lib/firmware"
*** Including module: shutdown ***
*** Including modules done ***
*** Installing kernel module dependencies and firmware ***
*** Installing kernel module dependencies and firmware done ***
*** Resolving executable dependencies ***
*** Resolving executable dependencies done***
*** Hardlinking files ***
*** Hardlinking files done ***
*** Stripping files ***
*** Stripping files done ***
*** Generating early-microcode cpio image contents ***
*** Constructing GenuineIntel.bin ****
*** Store current command line parameters ***
*** Creating image file ***
*** Creating microcode section ***
*** Created microcode section ***
*** Creating image file done ***
*** Creating initramfs image file '/boot/initramfs-3.10.0-1160.15.2.el7.x86_64.img' done ***

#Проверка
[root@localhost 01test]# lsinitrd -m /boot/initramfs-$(uname -r).img | grep test
test
[root@localhost 01test]#



